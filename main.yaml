---
- hosts: localhost
  gather_facts: no

  vars_files:
    - "vars/creds.yaml"

  tasks:
    - name: Avi Deploy new virtual
      include_role:
        name: avinetworks.aviconfig
      vars:
        cloud_name: "Default-Cloud"
        tenant_name: "admin"
        app_name: "{{ ApplicationName }}"
        app_type: "{{ ApplicationType }}"
        department: "{{ Department }}"
        health_monitor: "{{ HealthMonitor }}"
        listening_port: "{{ ListeningPort }}"
        pool_members: "{{  PoolMembers.split('::') }}"
        avi_config_state: "present"
        avi_controller: "{{ aws_avi_controller_1 }}"
        avi_username: "{{ aws_tower_username }}"
        avi_password: "{{ aws_tower_password }}"
        api_version: "18.2.8"
        tmp_avi_config: "{{ lookup('template','template/vs_create.j2') | from_yaml }}"
        avi_config: "{{tmp_avi_config.avi_config }}"